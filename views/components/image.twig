
{% set image = image.id ? Image(image.id) : image %}
{% set size = size ?: false %}
{% set image_src = size and image.src(size) ? image.src(size) : image.src %}
{% set image_srcset = image.srcset(size) ? "srcset='" ~ image.srcset(size) ~ "'" : '' %}
{% set classes = classes %}
{% set caption = caption ?? image.caption %}
{% set caption_classes = caption_classes %}
{% set figure_classes = figure_classes %}
{% set figcaption_classes = figcaption_classes %}
{% set text_align = text_align %}

{#
# Temporary check for images wider than a 2:1 aspect ratio with the word "logo" in the filename.
# Remove this when these "placeholder images" are removed from the website!
# See: https://github.com/thinkshout/aiusa/issues/291
#}
{% set is_wide_logo = 'logo' in image.src and image.height > 0 and image.width / image.height > 2 %}

{% if image and not is_wide_logo %}
  <figure class="{{ figure_classes }}">
    <img src="{{ image_src }}" {{ image_srcset }}
       width="{{ image.width }}" height="{{ image.height }}"
       alt="{{ image.alt }}" class="{{ classes }}">
    {% if caption %}
      {% if caption_style == "hidden" %}
        {# For hidden captions, make them only available to screen readers #}
        {% include "/components/caption--below.twig" with {
          caption: caption,
          caption_classes: '',
          figcaption_classes: '',
          figcaption_classes: 'sr-only',
        } %}
      {% elseif caption_style == "over" %}
        {% include "/components/caption--over.twig" with {
          caption: caption,
          caption_classes: caption_classes,
          figcaption_classes: figcaption_classes,
          text_align: text_align
        } %}
      {% else %}
        {% include "/components/caption--below.twig" with {
          caption: caption,
          caption_classes: caption_classes,
          figcaption_classes: figcaption_classes,
          text_align: text_align
        } %}
      {% endif %}
    {% endif %}
  </figure>
{% endif %}
